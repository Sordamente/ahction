/*! Driveline SDK */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=function(e){var t,n=new ArrayBuffer(256),o=new DataView(n),i=0,s=function(e){for(var r=n.byteLength,s=i+e;r<s;)r<<=1;if(r!==n.byteLength){var u=o;n=new ArrayBuffer(r),o=new DataView(n);for(var a=i+3>>2,c=0;c<a;++c)o.setUint32(c<<2,u.getUint32(c<<2))}return t=e,o},u=function(){i+=t},a=function(e){u(s(1).setUint8(i,e))},c=function(e){for(var t=s(e.length),n=0;n<e.length;++n)t.setUint8(i+n,e[n]);u()},l=function(e,t){var n;t<24?a(e<<5|t):t<256?(a(e<<5|24),a(t)):t<65536?(a(e<<5|25),n=t,u(s(2).setUint16(i,n))):t<4294967296?(a(e<<5|26),function(e){u(s(4).setUint32(i,e))}(t)):(a(e<<5|27),function(e){var t=e%4294967296,n=(e-t)/4294967296,r=s(8);r.setUint32(i,n),r.setUint32(i+4,t),u()}(t))};if(function e(t){var n;if(!1===t)return a(244);if(!0===t)return a(245);if(null===t)return a(246);if(void 0===t)return a(247);switch(r(t)){case"number":if(Math.floor(t)===t){if(0<=t&&t<=9007199254740992)return l(0,t);if(-9007199254740992<=t&&t<0)return l(1,-(t+1))}return a(251),function(e){u(s(8).setFloat64(i,e))}(t);case"string":var o=[];for(n=0;n<t.length;++n){var f=t.charCodeAt(n);f<128?o.push(f):f<2048?(o.push(192|f>>6),o.push(128|63&f)):f<55296?(o.push(224|f>>12),o.push(128|f>>6&63),o.push(128|63&f)):(f=(1023&f)<<10,f|=1023&t.charCodeAt(++n),f+=65536,o.push(240|f>>18),o.push(128|f>>12&63),o.push(128|f>>6&63),o.push(128|63&f))}return l(3,o.length),c(o);default:var h;if(Array.isArray(t))for(h=t.length,l(4,h),n=0;n<h;++n)e(t[n]);else if(t instanceof Uint8Array)l(2,t.length),c(t);else{var d=Object.keys(t);for(h=d.length,l(5,h),n=0;n<h;++n){var v=d[n];e(v),e(t[v])}}}}(e),"slice"in n)return n.slice(0,i);for(var f=new ArrayBuffer(i),h=new DataView(f),d=0;d<i;++d)h.setUint8(d,o.getUint8(d));return f},i=function(e,t,n){var r;r=e instanceof Uint8Array?new DataView(e.buffer,e.byteOffset,e.byteLength):new DataView(e);var o=0;"function"!=typeof t&&(t=function(e){return e}),"function"!=typeof n&&(n=function(){});var i=function(e,t){return o+=e,t},s=function(t){return i(t,new Uint8Array(e,o,t))},u=function(){return i(1,r.getUint8(o))},a=function(){return i(2,r.getUint16(o))},c=function(){return i(4,r.getUint32(o))},l=function(){return 255===r.getUint8(o)&&(o+=1,!0)},f=function(e){if(e<24)return e;if(24===e)return u();if(25===e)return a();if(26===e)return c();if(27===e)return 4294967296*c()+c();if(31===e)return-1;throw"Invalid length encoding"},h=function(e){var t=u();if(255===t)return-1;var n=f(31&t);if(n<0||t>>5!==e)throw"Invalid indefinite length element";return n},d=function(e,t){for(var n=0;n<t;++n){var r=u();0!=(128&r)&&(r<224?(r=(31&r)<<6|63&u(),t-=1):r<240?(r=(15&r)<<12|(63&u())<<6|63&u(),t-=2):(r=(15&r)<<18|(63&u())<<12|(63&u())<<6|63&u(),t-=3)),r<65536?e.push(r):(r-=65536,e.push(55296|r>>10),e.push(56320|1023&r))}},v=function e(){var c,v,y=u(),p=y>>5,m=31&y;if(7===p)switch(m){case 25:return function(){var e=new ArrayBuffer(4),t=new DataView(e),n=a(),r=32768&n,o=31744&n,i=1023&n;if(31744===o)o=261120;else if(0!==o)o+=114688;else if(0!==i)return(r?-1:1)*i*5.960464477539063e-8;return t.setUint32(0,r<<16|o<<13|i<<13),t.getFloat32(0)}();case 26:return i(4,r.getFloat32(o));case 27:return i(8,r.getFloat64(o))}if((v=f(m))<0&&(p<2||6<p))throw"Invalid length";switch(p){case 0:return v;case 1:return-1-v;case 2:if(v<0){for(var g=[],w=0;(v=h(p))>=0;)w+=v,g.push(s(v));var b=new Uint8Array(w),k=0;for(c=0;c<g.length;++c)b.set(g[c],k),k+=g[c].length;return b}return s(v);case 3:var C=[];if(v<0)for(;(v=h(p))>=0;)d(C,v);else d(C,v);return String.fromCharCode.apply(null,C);case 4:var A;if(v<0)for(A=[];!l();)A.push(e());else for(A=new Array(v),c=0;c<v;++c)A[c]=e();return A;case 5:var I={};for(c=0;c<v||v<0&&!l();++c)I[e()]=e();return I;case 6:return t(e(),v);case 7:switch(v){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;default:return n(v)}}}();if(o!==e.byteLength)throw"Remaining bytes";return v},s=new Error("connection lost");function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function l(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var y=function e(t,n){v(this,e),this.client=t,this.consumerId=n},p=function(e){function t(e,n,r,o,i){var s;return v(this,t),(s=l(this,f(t).call(this,e,n))).pattern=r,s.options=i,s.handler=o,s}return h(t,y),c(t,[{key:"response",value:function(){return this}},{key:"handleRecords",value:function(e){var t=e.records,n=e.error;if(n)return this.handler({error:n}),!1;var r=t[0];if(0===r.length)return this.handler(null),!1;for(var o=0;o<r.length;o++)this.handler(r[o]);return!0}},{key:"handleDisconnect",value:function(){return this.handler({error:s}),!1}},{key:"handleReconnect",value:function(){return!1}}]),t}(),m=function(e){function t(e,n,r,o){var i;return v(this,t),(i=l(this,f(t).call(this,e,n))).key=r,i.options=o,i.resp=new Promise(function(e,t){i.resolve=function(t){e(t),i.resolve=null,i.reject=null},i.reject=function(e){t(e),i.resolve=null,i.reject=null}}),i}return h(t,y),c(t,[{key:"response",value:function(){return this.resp}},{key:"handleRecords",value:function(e){var t=e.recordIds,n=e.records,r=e.error;return r?(this.reject(r),!1):(this.resolve({recordId:t[0],payload:n[0]}),!1)}},{key:"handleDisconnect",value:function(){return!0}},{key:"handleReconnect",value:function(){return this.client.runLoadConsumer(this),!0}}]),t}(),g=function(e){function t(e,n){var r;return v(this,t),(r=l(this,f(t).call(this,e,n))).resp=new Promise(function(e,t){r.resolve=function(t){e(t),r.resolve=null,r.reject=null},r.reject=function(e){t(e),r.resolve=null,r.reject=null}}),r}return h(t,y),c(t,[{key:"response",value:function(){return this.resp}},{key:"handleRecords",value:function(e){var t=e.error;return t?(this.reject(t),!1):(this.resolve(),!1)}},{key:"handleDisconnect",value:function(){return this.reject(s),!1}},{key:"handleReconnect",value:function(){return!1}}]),t}(),w=function(e){function t(e,n,r,o,i,s){var u;return v(this,t),(u=l(this,f(t).call(this,e,n))).isContinuous=r,u.dql=o,u.handler=i,u.options=s,u}return h(t,y),c(t,[{key:"cancel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.client.cancel(this,e)}},{key:"response",value:function(){return this}},{key:"handleRecords",value:function(e){var t=e.recordIds,n=e.records,r=e.error;if(r)return this.handler({error:r}),!1;if(!1===this.isContinuous&&0===n.length)return this.handler({record:null}),!1;for(var o=0;o<n.length;o++){var i=t[o];this.options.lastMessageId=i,this.handler({recordId:i,record:n[o]})}return!0}},{key:"handleDisconnect",value:function(){return!1!==this.isContinuous||(this.handler({error:s}),!1)}},{key:"handleReconnect",value:function(){return this.client.runQueryConsumer(this),!0}}]),t}();function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var k={bufferDelay:8e3,showStats:!0,maxAnnotations:1e3},C=function(){},A=function(){function e(t,n,r,o){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i=Object.assign({},k,i),this.client=t,this.canvas=n,this.drawCtx=n.getContext("2d"),this.drawCtx.font="15px Arial",this.drawCtx.lineWidth=2,this.configureAnnotations(o),this.videoStream=r,this.videoQuery=null,this.presenceInterval=null,this.firstFrameTime=0,this.playStartTime=0,this.scheduledFrames=[],this.restarts=0,this.playTimer=null,this.targetBufferDelay=i.bufferDelay,this.showStats=i.showStats,this.maxAnnotations=i.maxAnnotations}var t,n,r;return t=e,(n=[{key:"play",value:function(){this.stop(),this.startPresence(),this.startVideo(),this.startAnnotations()}},{key:"stop",value:function(){++this.restarts,this.stopPresence(),this.stopVideo(),this.stopAnnotations()}},{key:"isPlaying",value:function(){return!!this.videoQuery}},{key:"getDrawingContext",value:function(){return this.drawCtx}},{key:"getAnnotationsControls",value:function(){var e={};return this.annotations.forEach(function(t,n){return e[n]=t.control}),e}},{key:"getAnnotationControlForStream",value:function(e){var t=this.annotations.get(e);return t?t.control:null}},{key:"startVideo",value:function(){var e=this;this.firstFrameTime=0,this.videoQuery=this.client.continuousQuery("SELECT * FROM STREAM '".concat(this.videoStream,"/jpeg'"),function(t){var n=t.record;if(!t.error&&n.time&&n.jpeg&&n.width&&n.height){var r=1e3*n.time;(0===e.firstFrameTime||r<e.firstFrameTime||1===e.scheduledFrames.length&&1e3*e.scheduledFrames[0].record.time===e.firstFrameTime)&&(e.firstFrameTime=r,e.playStartTime=Date.now());var o=e.targetBufferDelay+r-e.firstFrameTime+e.playStartTime;e.scheduledFrames.push({when:o,record:n}),null===e.playTimer&&(e.playTimer=setTimeout(function(){e.playFrame(!1)},100))}})}},{key:"stopVideo",value:function(){this.videoQuery&&(this.client.cancel(this.videoQuery),this.videoQuery=null),this.playTimer&&(clearTimeout(this.playTimer),this.playTimer=null),this.scheduledFrames.length=0}},{key:"startAnnotations",value:function(){var e=this;this.annotations.forEach(function(t){return e.startAnnotation(t)})}},{key:"stopAnnotations",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.annotations.forEach(function(n){return e.stopAnnotation(n,t)})}},{key:"startAnnotation",value:function(e){var t=this;e.data.length=0;var n="SELECT * FROM STREAM '".concat(e.stream,"'");e.whereClause.length>0&&(n="".concat(n," WHERE ").concat(e.whereClause));var r=void 0;e.lastRecordId&&(r={lastMessageId:e.lastRecordId}),e.query=this.client.continuousQuery(n,function(n){var r=n.record,o=n.recordId;n.error||(e.data.push(r),e.lastRecordId=o,e.data.length>t.maxAnnotations&&e.data.shift(),e.forwarder({record:r,recordId:o}))},r)}},{key:"stopAnnotation",value:function(e,t){e.query&&(this.client.cancel(e.query),e.query=null),t&&(e.lastRecordId=null),e.data.length=0}},{key:"changeAnnotationFilter",value:function(e,t,n){e.whereClause=t||"",e.query&&(this.stopAnnotation(e,n),this.startAnnotation(e))}},{key:"configureAnnotations",value:function(e){var t=this;this.annotations=new Map;var n=function(n){if(!e.hasOwnProperty(n)||!n)return"continue";var r=e[n];"function"!=typeof r&&(console.error("stream ".concat(n,": presenter must be a function")),r=C);var o={stream:n,presenter:r,query:null,whereClause:"",data:[],lastRecordId:null,control:null,forwarder:C};o.control={start:function(){return t.startAnnotation(o)},stop:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return t.stopAnnotation(o,e)},setFilter:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t.changeAnnotationFilter(o,e,n)},tap:function(e){o.forwarder=e||C}},t.annotations.set(n,o)};for(var r in e)n(r)}},{key:"playFrame",value:function(e){var t=this;this.playTimer=!1;var n=this.scheduledFrames[0].record;e&&this.scheduledFrames.shift();var r=new Image;r.src="data:image/jpeg;charset=utf-8;base64,"+btoa(String.fromCharCode.apply(null,n.jpeg));var o=this.restarts;r.onload=function(){if(o===t.restarts){var e=t.canvas,i=t.drawCtx;if(i.drawImage(r,0,0,e.width,e.height),t.annotations.forEach(function(e){for(var t=e.stream,r=e.data,o=e.presenter;r.length>0&&r[0].timestamp<n.time;)r.shift();if(0!==r.length){var s=r[0];if(!(s.timestamp-n.time>=.1)){r.shift(),i.save();try{o(i,s)}catch(e){console.error("stream ".concat(t,": uncaught error in presenter"),e)}finally{i.restore()}}}}),t.showStats&&i.fillText("Buffer: ".concat(t.scheduledFrames.length.toString()),10,20),t.scheduledFrames.length>0){var s=t.scheduledFrames[0].when-Date.now();t.playTimer=setTimeout(function(){t.playFrame(!0)},s)}else t.playTimer=null}}}},{key:"startPresence",value:function(){var e=this,t=function(){e.client.isConnected()&&e.client.store("".concat(e.videoStream,"/view"),{time:Math.trunc(Date.now()/1e3)},{ttl:5e3})};t(),this.presenceInterval=setInterval(t,2e3)}},{key:"stopPresence",value:function(){this.presenceInterval&&(clearInterval(this.presenceInterval),this.presenceInterval=null)}}])&&b(t.prototype,n),r&&b(t,r),e}();function I(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||O(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function S(e,t){return T(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var s,u=e[Symbol.iterator]();!(r=(s=u.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}(e,t)||j()}function j(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function O(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function T(e){if(Array.isArray(e))return e}function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"DrivelineClient",function(){return F});var F=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=Object.assign({},x,n,{endpoint:t}),this.consumers=new Map,this.consumerId=0,this.connectAttempts=0,this.connect()}var t,n,r;return t=e,r=[{key:"connect",value:function(t,n){return new e(t,n)}}],(n=[{key:"isConnected",value:function(){return!!this.ws&&this.ws.readyState===WebSocket.OPEN}},{key:"connect",value:function(){var e,t,n;this.ws=(t=(e=this).options.endpoint,(n=new WebSocket(t,"driveline")).binaryType="arraybuffer",n.addEventListener("open",function(t){return e.webSocketConnected()}),n.addEventListener("close",function(t){return e.webSocketDisconnected()}),n.addEventListener("error",function(t){return e.webSocketFailed()}),n.addEventListener("message",function(t){return e.webSocketReceivedMessage(t.data)}),n)}},{key:"sync",value:function(){var e=new g(this,this.consumerId++);return this.registerConsumer(e),this.ws_send("syn",e.consumerId),e.response()}},{key:"append",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t=new Uint8Array(o(t)),n=Object.assign({},R,n);var r=q(n);this.ws_send("app",e,r,t)}},{key:"continuousQuery",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n=Object.assign({},M,n);var r=new w(this,this.consumerId++,!0,e,t,n);return this.registerConsumer(r),this.runQueryConsumer(r)}},{key:"query",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n=Object.assign({},M,n);var r=new w(this,this.consumerId++,!1,e,t,n);return this.registerConsumer(r),this.runQueryConsumer(r)}},{key:"cancel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.unregisterConsumer(e)&&this.isConnected()){t=Object.assign({},D,t);var n=V(t);this.ws_send("can",e.consumerId,n)}}},{key:"runQueryConsumer",value:function(e){var t=H(e.options),n=e.isContinuous?"sq":"qq";return this.ws_send(n,e.consumerId,t,e.dql),e.response()}},{key:"truncate",value:function(e){this.ws_send("trc",void 0,e)}},{key:"load",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=Object.assign({},U,t);var n=new m(this,this.consumerId++,e,t);return this.registerConsumer(n),this.runLoadConsumer(n)}},{key:"runLoadConsumer",value:function(e){var t=W(e.options);return this.ws_send("ld",e.consumerId,t,e.key),e.response()}},{key:"store",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t=new Uint8Array(o(t)),n=Object.assign({},Q,n);var r=N(n);this.ws_send("st",e,r,t)}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=Object.assign({},L,t);var n=K(t);this.ws_send("rm",n,e)}},{key:"removeMatches",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=Object.assign({},L,t);var n=K(t);this.ws_send("rmk",n,e)}},{key:"listKeys",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n=Object.assign({},P,n);var r=new p(this,this.consumerId++,e,t,n);return this.registerConsumer(r),this.runListConsumer("lst",r)}},{key:"listStreams",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n=Object.assign({},P,n);var r=new p(this,this.consumerId++,e,t,n);return this.registerConsumer(r),this.runListConsumer("sls",r)}},{key:"getVideoPlayback",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new A(this,e,t,n,r)}},{key:"runListConsumer",value:function(e,t){var n=B(t.options);return this.ws_send(e,t.consumerId,n,t.pattern),t.response()}},{key:"registerConsumer",value:function(e){this.consumers.set(e.consumerId,e)}},{key:"unregisterConsumer",value:function(e){return this.consumers.delete(e.consumerId)}},{key:"ws_send",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=o(t);this.ws.send(r)}},{key:"webSocketConnected",value:function(){var e;this.connectAttempts=0;var t=[];this.consumers.forEach(function(e,n){e.handleReconnect()||t.push(n)}),t.forEach((e=this.consumers).delete.bind(e)),this.options.onConnected&&(this.options.onConnected(this),this.options.onConnected=null)}},{key:"webSocketDisconnected",value:function(){var e,t=[];this.consumers.forEach(function(e,n){e.handleDisconnect()||t.push(n)}),t.forEach((e=this.consumers).delete.bind(e)),this.recover_connection()}},{key:"webSocketReceivedMessage",value:function(e){var t,n=i(e),r=null;switch(n[0]){case"data":var o=T(t=n)||O(t)||j(),s=o[1],u=o[2],a=o.slice(3);r={consumerId:s,recordIds:_(u||[]).recordIds,records:a.map(function(e){return e?i(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)):null})};break;case"syn":r={consumerId:S(n,2)[1],records:[],recordIds:[]};break;case"err":var c=S(n,3);r={consumerId:c[1],error:c[2]};break;default:return void console.error("unknown message received from server:",n)}if(this.consumers.has(r.consumerId)){var l=this.consumers.get(r.consumerId);l.handleRecords(r)||this.unregisterConsumer(l)}}},{key:"webSocketFailed",value:function(){this.recover_connection()}},{key:"recover_connection",value:function(){if(this.connectAttempts+=1,this.connectAttempts>=this.options.maxReconnect)this.options.onError&&this.options.onError(s);else{var e=500*(2^this.connectAttempts-1)/2;e>5e3&&(e=5e3),setTimeout(this.connect.bind(this),e)}}}])&&E(t.prototype,n),r&&E(t,r),e}(),_=function(e){for(var t=[],n=0;n<e.length;n+=2)1===e[n]&&t.push.apply(t,I(e[n+1]));return{recordIds:t}},x={maxReconnect:100,onConnected:function(e){},onError:function(e){}},R={},D={},P={},U={},M={},L={},Q={},q=function(){return null},V=function(){return null},B=function(){return null},W=function(){return null},H=function(e){var t=e.lastMessageId,n=[];return t&&n.push(2,t),n.length>0?n:null},K=function(){return null},N=function(e){var t=e.ttl,n=e.casId,r=[];return t&&r.push(4,t),n&&r.push(3,n),r.length>0?r:null}}])});
//# sourceMappingURL=driveline.js.map